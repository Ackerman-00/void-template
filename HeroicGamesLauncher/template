# Template file for 'HeroicGamesLauncher'
pkgname=HeroicGamesLauncher
version=2.18.1
revision=1
archs="x86_64"
short_desc="Open source launcher for GOG, Epic, and Amazon Games"
maintainer="Ackerman <https://github.com/Ackerman-00>"
license="GPL-3.0-or-later"
homepage="https://heroicgameslauncher.com"
distfiles="https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/releases/download/v${version}/Heroic-${version}-linux-amd64.deb"
checksum=471b058c659751999201502476b77241280f97223e7506927976e73792019777

hostmakedepends="binutils tar xz"
depends="nss atk alsa-lib libcups libdrm libgbm libXcomposite libXdamage libXrandr libXScrnSaver"

# Safety: Ignore PIE for bundled binaries inside the deb
nopie_files="/opt/Heroic/resources/app.asar.unpacked/build/bin/x64/linux/gogdl
 /opt/Heroic/resources/app.asar.unpacked/build/bin/x64/linux/legendary"
nostrip_files="${nopie_files}"

do_extract() {
    # Extract the .deb archive
    ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/Heroic-${version}-linux-amd64.deb
    mkdir -p ${wrksrc}
    # Unpack the data payload into the work directory
    tar xf data.tar.xz -C ${wrksrc}
}

do_install() {
    # Create the necessary system directories
    vmkdir usr/share/applications
    vmkdir usr/share/icons
    vmkdir opt/Heroic
    vmkdir usr/bin

    # Copy files from the extracted work directory to the destination
    vcopy usr/share/applications/*.desktop usr/share/applications
    vcopy usr/share/icons/hicolor usr/share/icons
    vcopy opt/Heroic/* opt/Heroic

    # Set up the symlink so it can be run from terminal as 'heroic'
    ln -sf /opt/Heroic/heroic ${DESTDIR}/usr/bin/heroic

    # Fix permissions for the main binary
    chmod 755 ${DESTDIR}/opt/Heroic/heroic
}
